<script>//СentroidСlustering
	function Point(input){rezPoint= new List();/*Обнуляем*/for(iPoint=0;iPoint<input.at(0).Count()-1;iPoint++){rezPoint.add(+0);}delete iPoint;/*Складываем всё что можем*/for(iPoint=1;iPoint<input.Count();iPoint++){for(jPoint=1;jPoint<input.at(0).Count();jPoint++){rezPoint.a[jPoint-1]=rezPoint.a[jPoint-1]+parseFloat(input.at(iPoint).at(jPoint));}}delete iPoint;delete jPoint;/*Делим всё на ноль*/for(iPoint=0;iPoint<rezPoint.Count();iPoint++){rezPoint.a[iPoint]=rezPoint.a[iPoint]/(rezPoint.Count());}delete iPoint;return rezPoint;delete rezPoint;}
	function Distance(input1,input2){i1Distance=Point(input1);i2Distance=Point(input2);rezDistance=0;if(i1Distance.Count()==i2Distance.Count()){for(iDistance=0;iDistance<i1Distance.Count();iDistance++){qwe=i1Distance.at(iDistance)-i2Distance.at(iDistance);rezDistance=rezDistance+qwe*qwe;delete qwe;}delete iDistance;}delete i1Distance;delete i2Distance;rezDistance=Math.sqrt(rezDistance);return rezDistance}

	function DataSightGet(data,x,xx,xxx){
		rez= data.at(x).at(xx+1).at(xxx+1)
		return rez
	}	
	function СentroidСlustering(realinput,k,ToBeeNorm){	
		//alert(ToBeeNorm+" dhndjhjkjdjhkldjh");
		input = new List();
		input.addList(realinput);
		OutPutСluster = new List();	
		for(i=1;i<input.Count()-1;i++){
			//Создаём новый объект-кластер-предприятие
			NewCluster = new List();
			NewCluster.add(input.at(0));			
			NewCluster.add(input.at(i));
			//Копируем новый объект-кластер-предприятие
			OutPutСluster.add(NewCluster);
		}
		//Нормирование
		//Перебор параметров
		maxList = new List();
		if(ToBeeNorm){
			for(j=0;j<OutPutСluster.at(0).at(1).Count()-1;j++){
				max=-9999999999;
				//Перебор кластеров - предприятий
				for(i=0;i<OutPutСluster.Count();i++){
					qwe=DataSightGet(OutPutСluster,i,0,j);
					if(qwe>max){
						max=qwe;
					}
				}			
				for(i=0;i<OutPutСluster.Count();i++){
					qwe=DataSightGet(OutPutСluster,i,0,j)/max;
					OutPutСluster.a[i].a[0+1].a[j+1] = qwe;
				}			
				maxList.add(max);
			}
		}
		delete input;
		delete Realinput;
		delete i;
		//Перибераем всякую
		if(OutPutСluster.Count()>2)
		{	
			do {		
				//Найти минимальный элемент				
				min= 9999999999999999;			
				minI=0;minJ=0;
				for(i=0;i<OutPutСluster.Count();i++){											
					for(j=0;j<OutPutСluster.Count();j++){
						di= Distance(OutPutСluster.at(i),OutPutСluster.at(j)) ;
						if(i!=j){if( min >  di){min=di;minI=i;minJ=j;}}delete di;
					}
				}
				delete i;delete j;delete min;/*Сгрупперовать два мини мальных элемента*/NewC= new List();NewC.add(OutPutСluster.at(minI).at(0));/*Добавляем все элементы из minI*/for(i=1;i<OutPutСluster.at(minI).Count();i++){NewC.add(OutPutСluster.at(minI).at(i));}delete i;/*Добавляем все элементы из minJ*/for(i=1;i<OutPutСluster.at(minJ).Count();i++){NewC.add(OutPutСluster.at(minJ).at(i));}delete i;/*Удаляем minI minJ*/if(minI>minJ){OutPutСluster=OutPutСluster.removeat(minI);OutPutСluster=OutPutСluster.removeat(minJ);}else{OutPutСluster=OutPutСluster.removeat(minJ);OutPutСluster=OutPutСluster.removeat(minI);}/*Добавляем отсебятинки*/OutPutСluster.add(NewC);
			//Радуемся жизни			
			} while (OutPutСluster.Count()>k);						
		}
		/*Делаем возврат. Перебор кластеров - предприятий*/
		if(ToBeeNorm){
			for(i=0;i<OutPutСluster.Count();i++){
				//Перебор содержимого кластеров - предприятий
				for(j=0;j<OutPutСluster.a[i].Count();j++){									
					if(j>0)
					{
						for(z=0;z<maxList.Count();z++){
							OutPutСluster.a[i].a[j].a[z+1]=OutPutСluster.a[i].a[j].a[z+1]*maxList.a[z];
						}
					}
				}
			}
		}
		return OutPutСluster;
	}
</script>